---
layout: post
title: "RISC-V Programming"
permalink: /projects/riscV
---

# 프로젝트 개요

이 프로젝트는 RISC-V 기본 명령어(ADD, SUB, ADDI, …) 및 추가 명령어(EXIT)를 해석하여 32비트 기계어로 변환하고, 명령어가 실행되는 동안의 PC(Program Counter) 변화를 추적하는 프로그램을 구현하는 것이 목표입니다.
  
입력으로 Assembly 코드 파일(*.s)을 받아, 이를 해석하여 기계어(*.o) 및 트레이스(*.trace) 파일을 생성합니다.

## 개발 언어 및 환경:
- C 언어
- Linux 환경에서 GCC 사용

## 주요 구현 내용  
- 어셈블리 코드를 읽어 들여 **2단계(2-pass)**로 처리


    1. 1차 패스: 레이블(Label) 처리 및 명령어 수집  
    2. 2차 패스: 명령어를 32비트 기계어로 인코딩

- 변환된 기계어를 *.o 파일로 생성
- 실행 시뮬레이션을 통해 프로그램 실행 과정에서 변경되는 PC 값을 *.trace로 기록  

## 주요 제약 사항
- 지정된 23개의 RISC-V 기본 명령어와 EXIT(0xFFFFFFFF)만 사용
- x0 ~ x31 레지스터 사용 (x1, x2, x3, … 값 일부 초기화)
- 문법 오류가 있을 경우 에러 메시지를 출력하고 파일을 생성하지 않음

# 프로그램 구성

1. 어셈블러(Assembler) 
   - first_pass: 명령어 라인별로 레이블을 수집하고, 명령어 형식을 확인합니다.  
   - second_pass: 1차 패스에서 수집된 정보를 활용하여 실제 32비트 기계어로 인코딩합니다. (R, I, S, B, J 등 명령어 유형별 처리)
   - 에러 처리: 정의되지 않은 레이블 사용, 지원되지 않는 명령어 사용, 형식 오류 등이 발생하면 “Syntax Error!!” 메시지를 출력합니다

2. 시뮬레이터(Simulator)
   - 변환된 기계어(*.o 파일)를 바탕으로 가상 메모리에 로드한 뒤 명령어를 순차 실행합니다.
   - 분기(branch)나 점프(jump) 명령어가 있을 경우, 해당 레이블 주소 혹은 목적지 레지스터를 통해 PC를 갱신합니다.
   - 실행 중 변경되는 PC 값을 *.trace 파일에 기록합니다.
   - EXIT 명령어(0xFFFFFFFF)가 나오면 프로그램 실행이 종료됩니다.   
3. 자료구조 및 보조 함수
   - Label 구조체: 레이블의 이름과 해당 명령어가 위치한 주소 저장
   - Instruction 구조체: 특정 주소에 대응하는 기계어 및 관련 정보 저장
   - Register 배열: x0 ~ x31 레지스터의 현재 값 관리
   - 주요 보조 함수:
     - trim_whitespace(), parse_register(), get_label_address(), uint32_to_binary(), …

  
## 간단한 실행 예시
아래는 예시 파일 `test1.s`을 입력받았을 때, 생성되는 출력 파일 예시입니다(*.o, *.trace). 실제 코드 및 테스트 파일은 [GitHub 링크](https://github.com/kenzz55/RISC_V-Programming)에서 확인 가능합니다.

```shell
>> Enter Input File Name: test1.s  
...
test1.o
00000000001000001000001110110011
01000000010000011000010000110011
...
(중략)
test1.trace
1000
1004
1008
...
```
- *.o 파일에는 변환된 32비트 기계어가 한 줄에 하나씩 기록됩니다.
- *.trace 파일에는 명령어 실행 시 변화된 PC 값이 순서대로 기록됩니다.


## 마무리 및 참고 

RISC-V 명령어 구조와 분기/점프 명령어에 따른 PC 변화와 레지스터 값 업데이트 로직을 직접 구현해 보았습니다.

자세한 소스 코드(C 파일)와 테스트 결과(*.s, *.o, *.trace)는 모두 GitHub에 업로드해 두었으니, 구체적인 로직이나 구현 세부 사항이 궁금하신 분들은 참고해 주세요.

[RISC-V 프로그래밍 소스코드 및 테스트 파일](https://github.com/kenzz55/RISC_V-Programming)
